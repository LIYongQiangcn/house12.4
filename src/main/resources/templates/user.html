<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, user-scalable=no, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
    <title>用户列表</title>
    <link rel="stylesheet" href="/layui/css/layui.css" >
    <script src="/layui/layui.js"></script>
    <script src="/layui/lay/modules/jquery.js"></script>
    <style>
        body{margin: 10px;}
        .demo-carousel{height: 200px; line-height: 250px; text-align: center;}
    </style>
</head>
<body>
<div class="layui-tab layui-tab-brief">
    <ul class="layui-tab-title">
        <li class="layui-this">用户列表</li>
    </ul>
</div>
<div style="width: 100%">
    <div class="layui-input-inline">
        <form class="layui-form" >
            <div class="layui-form-item">
                <label class="layui-form-label">搜索条件</label>
                <div class="layui-input-inline">
                    <select name="type" id="type">
                        <option value="0">用户名</option>
                        <option value="1">性别</option>
                    </select>
                </div>
                <div class="layui-input-inline">
                    <input type="text" id="name" name="name" lay-verify="" placeholder="请输入搜索的信息" autocomplete="off" class="layui-input">
                </div>
                <button class="layui-btn" id="BtnSearchUserInfo" type="button"><i class="layui-icon" style="font-size: 18px;color:white;">&#xe615;</i>搜索</button>
            </div>
        </form>
    </div>

</div>
<table  th:id="usertable" class="layui-hide" lay-filter="usertable"></table>
<style type="text/css">
    .layui-table-cell{
        text-align:center;
        height: auto;
        white-space: normal;
    }
    .layui-table img{
        max-width:300px
    }
</style>


<!--按钮的设置 onclick="updateButton()" -->
<script type="text/html" id="barDemo">
    <button type="button"  lay-event="like" class="layui-btn layui-btn-xs layui-btn-radius layui-btn-danger">删除用户</button>
    <button  type="button"  lay-event="edit" class="layui-btn layui-btn-xs layui-btn-radius layui-btn-sm"  >查看信息</button>
</script>

<!--头工具栏按钮设置-->
<!--<script type="text/html" id="titlebutton">-->
<!--    <button  type="button"  lay-event="add" class="layui-btn layui-btn-xs layui-btn-radius layui-btn-sm" lay-submit="" lay-filter="editsubmit"><i class="layui-icon layui-icon-add-1">发帖</i></button>-->
<!--    <button type="button"  lay-event="Myblog"  class="layui-btn layui-btn-xs layui-btn-radius layui-btn-danger">我的文章</button>-->
<!--    <button type="button"  lay-event="return"  class="layui-btn layui-btn-xs layui-btn-radius layui-btn-danger">退出登录</button>-->
<!--</script>-->
<script>
    layui.use(['table','layer','form','jquery','laypage','element'], function() {
        var table = layui.table; //表格
        var layer = layui.layer;
        var form = layui.form;
        var $ = layui.jquery;
        var laypage=layui.laypage;
        var element = layui.element;//元素操作

        //执行一个 table 实例
        table.render({
            code:'0',
            elem: '#usertable',//demo是table的id名
            url: '/user/query' ,//数据接口
            title: '博文表',
            page:true,
            cols: [
                [ //表头
                    {
                    field: 'uid',
                    title: 'ID'
                }, {
                    field: 'name',
                    title: '用户名'
                },  {
                    field: 'phone',
                    title: '电话号码'
                },{fixed:'right',width:165,align:'center',toolbar:'#barDemo'}]
            ]
        });

        $("#BtnSearchUserInfo").on("click",function () {
            table.reload('usertable',{
                where:{ //查询条件，传值到后台
                    type:$("#type").val(),
                    name:$("#name").val(),
                }
            })
        })




        //监听头工具栏事件
        table.on('toolbar(usertable)', function(obj){
            var checkStatus = table.checkStatus(obj.config.id)
                ,data = checkStatus.data; //获取选中的数据
            // var href;
            switch(obj.event){
                case 'add'://添加用户
                    layui.use('layer',function () {
                        var layer = layui.layer;
                        var index = layer.open({
                            type:2, //type 2表示iframe弹窗类型；layer type一般为5种类型
                            area: ['800px', '600px'],
                            fixed: false, //不固定
                            maxmin: true,
                            shadeClose: true,
                            anim:2,//弹框弹出方式
                            title:"添加页面",
                            content: 'admin/articles-add' //iframe展示当前页面
                        });
                    });
                    break;
                case 'Myblog':
                    location.href="admin/myArticles";
                    break;
                case 'return':
                    location.href="admin/login";
                    break;
            };
        });


        //监听按钮工具事件
        table.on('tool(usertable)', function (obj) {
            var data = obj.data;
            var layEvent = obj.event; //获得 lay-event 对应的值（也可以是表头的 event 参数对应的值）
            var tr = obj.tr;
            //console.log(obj)
            switch (layEvent) {
                case 'like':
                    layer.confirm('确定点赞吗?', function (index) {
                        $.ajax({
                            type: 'post',//提交方式
                            url: '/articles/updateLc',//访问后台的地址   查询所有的岗位信息
                            async: false,//  true：异步     false:同步
                            dataType: "json",//数据类型
                            data: {aid: data.aid},
                            success:function (data) {
                                if (data==1){
                                    layer.msg('点赞成功');
                                    window.parent.location.reload();
                                }else {
                                    alert("失败");
                                }
                            }
                        });
                        // alert(datacontent["uid"]);
                        // layer.close(index);
                    });
                    break;
                case 'edit':
                    layer.open(
                        {
                            type: 2,
                            title: '查看博文',
                            shadeClose: true,//点击其他地方关闭弹层
                            maxmin: true,
                            shade:0.3,  //设置透明度 ，默认 0.3
                            fixed: false,//不固定弹框 可以随意拖动
                            area: ['880px', '600px'],
                            content:'admin/articles-look',//跳转的页面 js获取// 'user-edit.html?id='+data.uid
                            success:function(layero, index){
                                // 获取子页面的iframe
                                var iframe = window['layui-layer-iframe' + index];
                                // 向子页面的全局函数child传参
                                iframe.child(data);
                            }
                        })
                    break;
            }
        });

    });
</script>
<!--头像显示路径配置-->
<script type="text/html" id="imgtmp">
    <img src="/ioReadImage/{{d.headportrait}}" style="width:108px;height:100px;"/>
</script>
</body>
</html>
